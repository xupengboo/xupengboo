# å¾®ä¿¡äº‘æ‰˜ç®¡

ç¡®å®æ˜¯ä¸ªå¥½å¹³å°ï¼Œéƒ¨ç½²ä¸ªé¡¹ç›®å¾ˆç®€æ˜“ï¼Œå…å»äº†å¾ˆå¤šè¿ç»´ä¸Šçš„äº‹æƒ…ã€‚

**ä¸€ã€å¾®ä¿¡äº‘æ‰˜ç®¡ github æµæ°´çº¿é…ç½® å’Œ ç«¯å£å·**ï¼š

1. é¦–å…ˆï¼Œè¿™é‡Œçš„**`ä¸»ä½“(å®¿ä¸»æœº)`ï¼ŒæŒ‡çš„å°±æ˜¯ä½ çš„ä»£ç æœ¬èº«**ï¼Œå¯ä»¥ç†è§£ä¸ºæœ‰ä¸€ä¸ªæœåŠ¡å™¨æ‹‰å–äº†ä½ çš„ä»£ç ã€‚
- ä¾‹å¦‚ï¼šDockerfileæ–‡ä»¶ä¸­ï¼ŒæŒ‡ä»¤ï¼š`COPY src /demo-server/src` ä¸­çš„srcç›®å½•ï¼Œå°±æ˜¯ä»£ç è·¯å¾„ä¸­çš„srcç›®å½•ã€‚

2. **ç¼–å†™Dockerfileæ–‡ä»¶**ï¼ˆæ ¹æ®Dockerfileï¼Œåˆ›å»ºé•œåƒï¼Œå¯åŠ¨å®¹å™¨ï¼‰
- ä¾‹å¦‚ï¼š[å¦‚ä½•å†™ä¸€ä¸ªDockerfileæ–‡ä»¶ï¼Ÿ](https://github.com/ITholmes/hello-world/blob/master/%E5%AD%A6%E8%AF%86%E6%AE%BF%E5%A0%82/Docker/Dockerfile%EF%BC%9A%E5%A6%82%E4%BD%95%E5%86%99%E4%B8%80%E4%B8%AADockerfile%E6%96%87%E4%BB%B6%EF%BC%9F.md)

```Dockerfile
# é€‰æ‹©æ„å»ºç”¨åŸºç¡€é•œåƒã€‚å¦‚éœ€æ›´æ¢ï¼Œè¯·åˆ°[dockerhubå®˜æ–¹ä»“åº“](https://hub.docker.com/_/java?tab=tags)è‡ªè¡Œé€‰æ‹©åæ›¿æ¢ã€‚
FROM maven:3.6.0-jdk-8-slim as build
# æŒ‡å®šæ„å»ºè¿‡ç¨‹ä¸­çš„å·¥ä½œç›®å½•
WORKDIR /demo-server
# å°†srcç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œæ‹·è´åˆ°å·¥ä½œç›®å½•ä¸­srcç›®å½•ä¸‹ï¼ˆ.gitignore/.dockerignoreä¸­æ–‡ä»¶é™¤å¤–ï¼‰
COPY src /demo-server/src
# å°†pom.xmlæ–‡ä»¶å’Œsettings.xmlæ–‡ä»¶ï¼Œæ‹·è´åˆ°å·¥ä½œç›®å½•ä¸‹
COPY settings.xml pom.xml /demo-server/
# è‡ªå®šä¹‰settings.xml, é€‰ç”¨å›½å†…é•œåƒæºä»¥æé«˜ä¸‹è½½é€Ÿåº¦
RUN mvn -s /demo-server/settings.xml -f /demo-server/pom.xml clean package

# åŸºç¡€é•œåƒ
FROM  openjdk:8-jre
# ä½œè€…
MAINTAINER holmes
# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /demo-server
# å¤åˆ¶jaråŒ…
COPY --from=build /demo-server/target/*.jar .
# æš´éœ²ç«¯å£
EXPOSE 80
# å¯åŠ¨ç¨‹åº
CMD ["java","-jar","demo-server-1.0-SNAPSHOT.jar"]
```

3. æ˜ç™½é¡¹ç›®ï¼Œé‡‡ç”¨å“ªä¸ªç«¯å£å·ã€‚
- **å¾®ä¿¡äº‘æ‰˜ç®¡-æµæ°´çº¿é…ç½®ã€Dockerfileã€æœåŠ¡é…ç½®éƒ½ä¼šæœ‰ç«¯å£å·ï¼Œè¦æ˜ç¡®é…ç½®çš„ç«¯å£å·æ˜¯å“ªä¸ª**ã€‚
- **http 80 å’Œ https 443 ï¼Œè¿™ä¸¤ä¸ªåè®®é»˜è®¤çš„ç«¯å£ï¼Œå¤§å®¶éƒ½çŸ¥é“ï¼Œä½†æ˜¯ä¹Ÿå¾ˆå®¹æ˜“å¿½ç•¥ï¼**

> ğŸˆå‚è€ƒå®˜æ–¹ï¼šhttps://github.com/WeixinCloud/wxcloudrun-springboot

**äºŒã€å¦‚ä½•ä½¿ç”¨æœåŠ¡ åŸºç¡€ä¿¡æ¯-ç¯å¢ƒå˜é‡ ï¼Ÿ**

åœ¨å¾®ä¿¡äº‘æ‰˜ç®¡ä¸­ï¼Œé€šè¿‡é…ç½®ç¯å¢ƒå˜é‡ï¼Œä½ å¯ä»¥å‘å®¹å™¨ä¼ é€’éœ€è¦çš„é…ç½®ä¿¡æ¯ã€‚**è¿™ç±»ä¼¼äºåœ¨ Docker ä¸­ä½¿ç”¨ -e æˆ– --env é€‰é¡¹æ¥è®¾ç½®ç¯å¢ƒå˜é‡**ã€‚

å¾®ä¿¡äº‘æ‰˜ç®¡ä¸­çš„ç¯å¢ƒå˜é‡é…ç½®å¯èƒ½ç±»ä¼¼äºä»¥ä¸‹ Docker å‘½ä»¤ï¼š

```powershell
docker run -e KEY1=value1 -e KEY2=value2 -e ANOTHER_KEY=another_value my_image
```

ä¸Šè¿°å‘½ä»¤ä¸­ï¼Œ-e é€‰é¡¹ç”¨äºè®¾ç½®å®¹å™¨ä¸­çš„ç¯å¢ƒå˜é‡ï¼ŒKEY1ã€KEY2 å’Œ ANOTHER_KEY æ˜¯ç¯å¢ƒå˜é‡çš„åç§°ï¼Œè€Œ value1ã€value2 å’Œ another_value åˆ™æ˜¯ç›¸åº”ç¯å¢ƒå˜é‡çš„å€¼ã€‚

æé†’ä¸€ä¸‹ï¼Œä¸åŒæœåŠ¡è·å–ç¯å¢ƒå˜é‡çš„è¯­æ³•ä¸åŒï¼Œä¾‹å¦‚ï¼š

**SpringBoot ç¯å¢ƒå˜é‡é…ç½®ï¼š**
- SpringBoot ç¯å¢ƒå˜é‡æ›¿æ¢æ ¼å¼ä¸ºï¼š${xxx}

![image](https://github.com/ITholmes/hello-world/assets/70437837/ba4658b5-c763-4c45-ba72-5c02b26c4cf8)

```yml
# å¼€å‘ç¯å¢ƒé…ç½®
spring:
  # æ•°æ®æºé…ç½®
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driverClassName: com.mysql.cj.jdbc.Driver
    druid:
      # ä¸»åº“æ•°æ®æº
      master:
        url: jdbc:mysql://${mysql_address}/holmes-center?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8
        username: root
        password: ${mysql_address_password}
```

**Nginx ç¯å¢ƒå˜é‡é…ç½®ï¼š**
- Nginx ç¯å¢ƒå˜é‡æ›¿æ¢æ ¼å¼ä¸ºï¼š$xxx


```nginx.conf
# ç”Ÿäº§ç¯å¢ƒ
location /prod-api/ {
  rewrite ^/prod-api(/.*)$ $1 break;
  # æ ¹æ® å¾®ä¿¡äº‘æ‰˜ç®¡ç¯å¢ƒå˜é‡ é…ç½®
  proxy_pass $SERVER_ADDRESS;
}
```





